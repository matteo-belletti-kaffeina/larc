(function(){jQuery(document).ready(function(e){e(".group").hide();e(".section-group").hide();e(".tab-group").hide();e("#mp-option-books").show();var t=e('<div id="curtain"><div class="fb-spinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div></div>');e("#bg-content").append(t);e("#confirm_update").on("click",function(t){e("#update_warning").slideUp(function(){e("#update_warning").remove()});e.post(ajaxurl,{action:"disable_warning"});t.preventDefault()});e("#request_backup").on("click",function(e){var t=ajaxurl+"?action=export_flipbooks";location.href=t;e.preventDefault()});e(".wrap").on("click","table.pages-table a.edit-page",function(t){var a=e(this);a.parents(".pages-table").find(".add-page.cancel").each(function(){e(this).trigger("click")});if(!a.parents("tr.display").next().is(":visible")){l(a.parents("tr.display").next().find("#rfbwp_page_css"));d(a.parents("tr.display").next().find("#field-rfbwp_page_html, #field-rfbwp_page_html_second"));h(a.parents("tr.display").next().find(".rfbwp-page-toc-popup"));b(a.parents("tr.display").next())}a.parents("tr.display").next().slideToggle();a.parents("tr.display").next().find("a.rfbwp-page-save span.desc").text("Save Changes");a.parents("tr.display").next().find("a.rfbwp-page-save").attr("href","#Save Changes");t.preventDefault()});e(".wrap").on("click","table.pages-table a.delete-page",function(t){t.preventDefault();var a=e(this),i=a.parents("div.pages").attr("id"),s=a.parents("tr.display").attr("id"),n=a.parents("div.pages"),r;K();a.parents("tr.display").slideUp("slow",function(){var t=a.parents("tr.display").next("tr.page-set").find("input, select, textarea").serializeArray();if(a.parents("tr.display").next().hasClass("page-set"))a.parents("tr.display").next().remove();a.parents("tr.display").remove();var p=G(s);var o=G(i);e.post(ajaxurl,{action:"save_settings",data:t,value:"Delete Page",activeID:o,pageID:p,curPageID:p,updating:"delete_page"},function(t){if(t.indexOf("mpc_data_size_exceeded")!=-1){V("red",mpcthLocalize.messages.dialogs.maxInputVars,15e3)}$();E(n);R(n);if(n.find("table.pages-table tr.page-set").length==0){e("li.button-sidebar.selected a").trigger("click");e(".books").hide();r=setInterval(function(){var t=n.attr("id");t=G(t);Q();e(".books tr:nth-child("+(parseInt(t)+1)+")").find("a.view-pages").trigger("click");clearInterval(r)},150)}})})});e(".wrap").on("click","table.pages-table tr.display a.down-page, table.pages-table tr.display a.up-page",function(t){t.preventDefault();var a=e(this),i=a.parents("tr.display"),s=i.next(),n,r,p,o,l;if(a.hasClass("up-page"))p="up";else p="down";if(p=="up"){if(s.hasClass("page-set")){n=parseInt(s.find("input#rfbwp_fb_page_index").attr("value"));if(i.prev().find("select.rfbwp-page-type option:selected").text()=="Double Page")n-=2;else n-=1}}else if(p=="down"){if(s.hasClass("page-set")){n=parseInt(s.find("input#rfbwp_fb_page_index").attr("value"));if(s.next().next().find("select.rfbwp-page-type option:selected").text()=="Double Page")n+=2;else n+=1}}if(p=="down"){if(s.next().hasClass("display")){l=s.next().next()}else{l="error";V("orange",mpcthLocalize.messages.dialogs.bottomPage,2e3)}if(l!="error"){i.find("span.page-index").text(n);s.find("input#rfbwp_fb_page_index").attr("value",n);var d=parseInt(s.next().next().find("input#rfbwp_fb_page_index").attr("value"),10);if(s.find("select.rfbwp-page-type option:selected").text()=="Double Page")d-=2;else d-=1;s.next().next().find("input#rfbwp_fb_page_index").attr("value",d);i.slideUp("fast",function(){l.after(s);l.after(i);i.slideDown();J(e(this).parents("div.pages"));R(e(this).parents("div.pages"));s.find("a.rfbwp-page-save").attr("href","#Save Changes");s.find("a.rfbwp-page-save").trigger("click",["move_down"])})}}else if(p=="up"){if(i.prev().prev().hasClass("display")){l=i.prev().prev()}else{l="error";V("orange",mpcthLocalize.messages.dialogs.topPage,2e3)}if(l!="error"){i.find("span.page-index").text(n);s.find("input#rfbwp_fb_page_index").attr("value",n);var d=parseInt(i.prev().find("input#rfbwp_fb_page_index").attr("value"),10);if(s.find("select.rfbwp-page-type option:selected").text()=="Double Page")d+=2;else d+=1;i.prev().find("input#rfbwp_fb_page_index").attr("value",d);i.slideUp("fast",function(){l.before(i);l.before(s);i.slideDown();J(e(this).parents("div.pages"));R(e(this).parents("div.pages"));s.find("a.rfbwp-page-save").attr("href","#Save Changes");s.find("a.rfbwp-page-save").trigger("click",["move_up"])})}}});function a(t){var a=t.next(),i,s,n=parseInt(a.find("input#rfbwp_fb_page_index").attr("value"));s=t.find("span.page-index").text();s=s.split("-");s=parseInt(s[0]);if(s>n)i="up";else i="down";if(s!=n){var r;t.slideUp();a.remove();t.parents("table.pages-table").find("tr.page-set").each(function(){var t=e(this);if(i=="down"){if(n>=parseInt(t.find("input#rfbwp_fb_page_index").attr("value"))){r=t}}else{if(n>=parseInt(t.find("input#rfbwp_fb_page_index").attr("value"))){r=t}}});if(i=="down"){t.find("span.page-index").text(n);t.slideUp("fast",function(){r.after(a);r.after(t);t.slideDown();J(e(this).parents("div.pages"));R(e(this).parents("div.pages"))})}else{t.find("span.page-index").text(n);t.slideUp("fast",function(){r.prev().before(t);r.prev().before(a);t.slideDown();J(e(this).parents("div.pages"));R(e(this).parents("div.pages"))})}}else{J(e(this).parents("div.pages"));R(e(this).parents("div.pages"))}}e(".wrap").on("click","a.add-book",function(t){t.preventDefault();e.post(ajaxurl,{action:"add_new_book"},function(t){var a=parseInt(t);e("a#mp-option-settings_"+a+"-tab").addClass("add");e("a#mp-option-settings_"+a+"-tab").click();Q();e("div.breadcrumbs span.breadcrumb-1 span.active").fadeIn();e("div.breadcrumbs span.breadcrumb-1").addClass("selected");e("div.breadcrumbs span.breadcrumb-2").fadeOut();b(e("#mp-option-settings_"+a).find('[data-toggle-section="field-rfbwp_fb_name"]'));O("book-settings",a);e("div.bottom-nav").find("a.edit-button").attr("value","Save Settings")})});e(".wrap").on("click","div.pages a.add-page",function(t){t.preventDefault();var a=e(this),i=a.parents("tr.display").attr("id");a.parents(".pages-table").find("tr.display:not(#"+i+")").each(function(){e(this).find(".add-page.cancel").trigger("click")});E(a.parents("table.pages-table"));var s=a.parents("tr.display").next().clone(true);if(a.hasClass("cancel"))a.removeClass("cancel").find("span").text(mpcthLocalize.addNewPage);else a.addClass("cancel").find("span").text(mpcthLocalize.cancelNewPage);if(a.parents("tr.display").next().next().hasClass("page-set")&&a.parents("tr.display").next().next().css("display")!="none"){a.parents("tr.display").next().next().slideUp("slow",function(){e(this).remove();E(a.parents("table.pages-table"))});return}if(a.parents("tr.display").next().css("display")!="none")a.parents("tr.display").next().slideUp("slow");var n=0;a.parents("tr.display").next().after(s);a.parents("tr.display").next().next().find("select.rfbwp-page-type option").prop("selected");a.parents("tr.display").find(".page-set").slideUp("slow");a.parents("tr.display").next().next().slideDown("slow");a.parents("tr.display").next().next().find("a.rfbwp-page-save span.desc").text("Save Page");a.parents("tr.display").next().next().find("a.rfbwp-page-save").attr("href","#Save Page");E(a.parents("table.pages-table"));A(a.parents("tr.display").next().next().attr("id"),a.parents(".group.pages").attr("id"))});e(".wrap").on("click","img.rfbwp-first-book",function(t){t.preventDefault();e(this).parents(".books").find("a.add-book").trigger("click")});e(".wrap").on("click","div.pages img.rfbwp-first-page",function(t){t.preventDefault();var a=e(this),i,s,n;$();e(".page-settings").css({display:"block"});e.post(ajaxurl,{action:"page_form"},function(t){n=G(a.parents("div.pages").attr("id"));s='<div class="rfbwp-add-page-form">';s+=t;e.post(ajaxurl,{action:"get_books_page_count",book_id:n},function(t){i=parseInt(t);a.prev().find("#pset_"+i).css({display:"block"});s=s.replace(/\[books]\[0]/g,"[books]["+n+"]");s=s.replace(/\[pages\]\[0\]/g,"[pages]["+i+"]");a.prev().find("div#ps_"+i).append(s);a.fadeOut();a.prev().find("div#ps_"+i).find("div.rfbwp-add-page-form").find("input#rfbwp_fb_page_index").attr("value","0");a.prev().find("div#ps_"+i).find("div.controls").children().each(function(){var t=e(this),a,i;if(t.attr("name")!=undefined&&t.attr("name")!=""){a=t.attr("name");a=a.split("[books][");i=a[1].split("[pages]");a=a[0]+"[books]["+n+"][pages]"+i[1];t.attr("name",a);if(t.attr("id")=="rfbwp_fb_page_index")t.val(0)}});l(a.prev().find("div#ps_"+i).find("#rfbwp_page_css"));d(a.prev().find("div#ps_"+i).find("#field-rfbwp_page_html, #field-rfbwp_page_html_second"));b(a.prev().find("div#ps_"+i));a.prev().find("div#ps_"+i).find("div.rfbwp-add-page-form").slideDown();$()})})});e("form#options-form").submit(function(e){e.preventDefault();return false});e(".wrap").on("submit","form#options-form",function(e){e.preventDefault();return false});e(".wrap").on("click","a.edit-button-alt",function(t){e(".bottom-nav .edit-button").trigger("click");t.preventDefault()});e(".wrap").on("keydown","form#options-form input",function(e){if(e.keyCode==13){e.preventDefault();e.stopPropagation()}});e(".wrap").on("click","form#options-form input.save-button, form#options-form a.edit-button, a.rfbwp-page-save",function(t,i){t.preventDefault();var s=e(this),n,r,p,o,l,d,f;K();if(s.parents("div.page-settings").attr("id")!=undefined){r=s.parents("div.page-settings").attr("id");r=G(r)}o=s.attr("href").toString();o=o.split("#");o=o[1];l=o;if(s.parents("div.pages").attr("id")!=undefined){d=s.parents("div.pages").attr("id")}else{s.parents("form").find("div.settings").each(function(){if(e(this).css("display")=="block")d=e(this).attr("id")})}if(d==undefined)f=l;else f=G(d);var c="",g=s.parents(".page-set").siblings("#page-display_"+r).length!=0;if(i!=undefined){c="move_page"}else if(r==undefined){c="book"}else if(r==0){c="first_page"}else if(r!=undefined&&g){c="edit_page"}else{c="new_page"}if(s.hasClass("rfbwp-page-save")&&r!="0"){var b="#page-display_"+(G(s.parents(".page-set").attr("id"))-1);if(s.parents(".pages-table").find(b+" .add-page").hasClass("cancel"))s.parents(".pages-table").find(b+" .add-page").removeClass("cancel").find("span").text(mpcthLocalize.addNewPage);s.parents("tr.page-set").slideUp("down",function(){N(e(this).attr("id"));if(o=="Save Changes"){a(s.parents("tr.page-set").prev());R(s.parents("div.pages"))}else{R(s.parents("div.pages"));J(s.parents("div.pages"));R(s.parents("div.pages"))}s.trigger("rfbwp.page-save");n=s.parents("tr.page-set").find("input, select, textarea").serializeArray();u()});e("html, body").animate({scrollTop:s.parents("tr.page-set").prev(".display").offset().top-32},250)}else if(i=="sortable"){c="edit_pages";n=e("#mp-option-pages_"+l).find("input, select, textarea").serializeArray();u()}else{if(r=="0"){s.parents("tr.page-set").slideUp("down",function(){if(o=="Save Changes"){a(s.parents("tr.page-set").prev());R(s.parents("div.pages"))}else{R(s.parents("div.pages"))}l="Edit Settings";s.trigger("rfbwp.first-page-save");n=s.parents("tr.page-set").find("input, select, textarea").serializeArray();u()});e("html, body").animate({scrollTop:s.parents("tr.page-set").prev(".display").offset().top-32},250)}else{l=s.val();if(s.val()!="Save Settings")e("#mp-option-settings_"+f).find(".breadcrumb-2").fadeIn();if(l==""&&s.hasClass("edit-button")||l==undefined&&s.hasClass("edit-button")){l="Edit Settings"}n=e("#mp-option-settings_"+f).find("input, select, textarea").serializeArray();u()}}function u(){e.post(ajaxurl,{action:"save_settings",data:n,activeID:f,curPageID:r,updating:c,value:l,moveDir:i},function(t){e(window).trigger("rfbwp-page-updated");if(t.indexOf("mpc_data_size_exceeded")!=-1){V("red",mpcthLocalize.messages.dialogs.maxInputVars,15e3)}$();if(c=="book"){e("div.group").each(function(){var t=e(this),a,i;if(t.css("display")=="block"&&t.hasClass("settings")){a=G(t.attr("id"));e("#mp-option-settings_"+f).find(".breadcrumb-2").fadeIn();V("green",mpcthLocalize.messages.dialogs.bookSaved,2e3);return false}})}})}return false});e(".wrap").on("rfbwp.firstTabReady",function(t,a){e(".books tr:nth-child("+(parseInt(a)+1)+")").find("a.view-pages").trigger("click")});e(".wrap").on("click","table.books a.delete-book",function(t){t.preventDefault();var a=e(this),i=a.parents("table.books"),s=a.attr("href").split("#");s=s[1];if(!confirm(mpcthLocalize.messages.dialogs.deleteBook+' "'+a.parents("td").find(".book-name .pretty-name").text()+'"')){return}K();e.post(ajaxurl,{action:"delete_book",id:s},function(t){if(t.indexOf("mpc_data_size_exceeded")!=-1){V("red",mpcthLocalize.messages.dialogs.maxInputVars,15e3)}a.parent().parent().slideUp(300,function(){a.parents("tr").remove();i.parents("form").find("div#mp-option-pages_"+s).remove();i.parents("form").find("div#mp-option-settings_"+s).remove()});e("li.button-sidebar.selected a").trigger("click",s);$()})});e(".wrap").on("click","div#bg-content div#sidebar ul > li:first-child",function(t,a){t.preventDefault();var i=false,s=false,n=false;e("div.field-books span").remove();e("div.field-books table.books").remove();e("div.field-books a.add-book").remove();e("div#top-nav ul#mp-section-flipbooks-tab li").each(function(){var t=e(this);if(t.find("a").hasClass("settings")||t.find("a").hasClass("pages"))t.remove()});e("form#options-form div.group").each(function(){var t=e(this);if(t.hasClass("settings")||t.hasClass("pages"))t.remove()});e.post(ajaxurl,{action:"rfbwp_refresh_books"},function(t){e("div.field-books div.controls").children().remove();e("div.field-books div.controls").append(t);i=true;if(a!=undefined&&a>-1&&i&&s&&n)e(".wrap").trigger("rfbwp.firstTabReady",a)});e.post(ajaxurl,{action:"rfbwp_refresh_tabs"},function(t){e("div#top-nav ul#mp-section-flipbooks-tab").append(t);s=true;if(a!=undefined&&a>-1&&i&&s&&n)e(".wrap").trigger("rfbwp.firstTabReady",a)});e.post(ajaxurl,{action:"rfbwp_refresh_tabs_content"},function(t){$();e("form#options-form div.group.books").after(t);e("form#options-form div.group").each(function(){var t=e(this);if(t.hasClass("settings")||t.hasClass("pages"))t.hide()});e("#mp-option-books").trigger("rfbwp.ajaxReady");n=true;if(a!=undefined&&a>-1&&i&&s&&n)e(".wrap").trigger("rfbwp.firstTabReady",a)})});e(".hide-checkbox").each(function(){var t=e(this).attr("id");var a=t.split("_checkbox");if(e(this).attr("checked")=="checked"){e("."+a[0]+"_wrap").show()}else{e("."+a[0]+"_wrap").hide()}});e(".hide-checkbox").change(function(){var t=e(this).attr("id");var a=t.split("_checkbox");if(e(this).attr("checked")=="checked"){e("."+a[0]+"_wrap").slideDown()}else{e("."+a[0]+"_wrap").slideUp()}if(e(this).parent().find("div").hasClass("mp-related-object")){var i=e(this).parent().find("div.mp-related-object").text();e("#"+i+"_checkbox").attr("checked",false);e("."+i+"_wrap").slideUp()}});e("textarea.displayall").each(function(){e(this).val(e(this).val())});e("textarea.displayall-upload").each(function(){var t=e(this).val();var a=t.split("http");t="";e.each(a,function(e,a){if(e!=0)t+="http"+a});e(this).val(t)});function i(e){var t=G(e.attr("id")),a=e.parents(".pages-table");a.find("#"+e.attr("id")).after(a.find("#pset_"+t))}function s(t){var a=1;t.find(".stacked-fields:not(:first-child):not(:last-child)").each(function(){var t=e(this),i=t.find(".checkbox").is(":checked");if(i){t.find("#"+t.data("section-id")+"_order input").val(a);a++}})}function n(t){var a=t.find(".stacked-fields:first-child"),i=t.find(".stacked-fields:last-child");var s=t.find(".stacked-fields:not(:first-child):not(:last-child)");var n=s.sort(function(t,a){var i=e(t).find("#"+e(t).data("section-id")+"_order input").val(),s=e(a).find("#"+e(a).data("section-id")+"_order input").val();return i>s});t.append(a);t.append(n);t.append(i)}function r(t){var a=0;t.find("tr.display").each(function(){var t=e(this);if(!t.next().hasClass("page-set"))i(t);var s=t.next(),n=t.find(".page-index"),r=s.find("input#rfbwp_fb_page_index");r.find("input#rfbwp_fb_page_index").attr("value",a);if(s.find("select.rfbwp-page-type option:selected").text()==="Double Page"){n.text(a+" - "+(a+1));a+=2}else{n.text(a);a++}});E(t.parents("div.pages"));var s=t.parents(".pages").attr("id"),n=G(s);e(".wrap").find("form#options-form a.edit-button").attr("href","#"+n).attr("value","Edit Settings");e(".wrap").find("form#options-form a.edit-button").trigger("click",["sortable"])}e(".wrap").on("click",".button-tab a, a.book-settings, a.view-pages",function(t){K();var a=e(this);a.addClass("selected");var i=a.attr("href");if(a.hasClass("book-settings")){b(e(i).find('[data-toggle-section="field-rfbwp_fb_name"]'));O("book-settings",G(a.attr("href")))}else if(a.hasClass("books"))O("books");else if(a.hasClass("add"))O("add");else if(a.hasClass("view-pages"))O("view-pages");e(".group").hide();var s;e(i).find("div.page-settings").each(function(){var t=e(this),a=t.attr("id");a=G(a);s=i+" tr#pset_"+a+" td";e(s).append(t);e(i+" tr#pset_"+a).css({display:"none"})});var n=G(i);if(n==undefined){e("#rfbwp_tools").attr("data-book-id","").stop(true,true);e("#rfbwp_import_id").val("")}else{e("#rfbwp_tools").attr("data-book-id",n).stop(true,true);e("#rfbwp_import_id").val(n)}if(n!=undefined){e.post(ajaxurl,{action:"set_active_book",activeID:n},function(){e(i).trigger("rfbwp.ajaxReady")})}if(a.hasClass("view-pages")){f(e(i));L(e(i));g(e(i))}if(a.hasClass("book-settings")){te(e(i));L(e(i))}e(i).fadeIn();$();t.preventDefault()});e(".group").on("rfbwp.ajaxReady",p);function p(a){e(this).fadeIn(300);t.stop(true).fadeOut(200,function(){j()})}e(".wrap").on("click",".button-sidebar a",function(t,a){var i=e(this);if(!i.parent().hasClass("selected")){e(".button-sidebar").removeClass("selected");i.parent().addClass("selected");e("div.breadcrumbs").fadeOut()}e(".tab-group").fadeOut("slow");var s=i.attr("href")+"-tab"+" .button-tab:first a";e(s).trigger("click");t.preventDefault()});e(".wrap").on("click","span.breadcrumb",function(t){t.preventDefault();K();var a=e(this),i=a.parents("div.group"),s,n;if(a.hasClass("selected"))if(!a.hasClass("image-batch"))return;else a.removeClass("image-batch");e("span.breadcrumb").each(function(){e(this).removeClass("selected")});n=G(i.attr("id"));e(".group").hide();if(a.hasClass("breadcrumb-1")){s="#mp-option-settings_"+n;te(e(s));L(e(s));b(e(s).find('[data-toggle-section="field-rfbwp_fb_name"]'));e(s).fadeIn();O("book-settings")}else if(a.hasClass("breadcrumb-2")){s="#mp-option-pages_"+n;f(e(s));e(s).find("div.page-settings").each(function(){var t=e(this),a=t.attr("id"),i="";a=G(a);i=s+" tr#pset_"+a+" td";e(i).append(t);e(s+" tr#pset_"+a).css({display:"none"})});g(e(s));L(e(s));var r=a.parents(".group").attr("id");r=G(r);e("li.button-sidebar.selected a").trigger("click",r);e(".books").hide();e(s).fadeIn();O("view-pages")}else if(a.hasClass("breadcrumb-0")){s="#mp-option-books";O("books-shelf");e(s).find("div.breadcrumbs").remove();e(s).fadeIn()}$()});var o=[];function l(e){if(!e.parent().find(".rfbwp_page_css_handler").length){var t="rfbwp_css_"+Math.floor(Math.random()*1e4),a=o.length;e.before('<div class="rfbwp_page_css_handler" id="'+t+'" data-index="'+a+'"></div>');o[a]=ace.edit(t);var i=e.hide();o[a].getSession().setValue(i.val());o[a].getSession().setMode("ace/mode/css");o[a].getSession().on("change",function(){i.val(o[a].getSession().getValue())})}}e(".wrap").on("click","#field-rfbwp_fb_page_columns_sc .rfbwp-page-columns-sc",function(){var t=e(this).parents("tr.page-set").find("#field-rfbwp_page_html_second"),a=e(this).parents("tr.page-set").find("#field-rfbwp_fb_page_toc_popup_second");t.toggleClass("active");a.toggleClass("active")});e(".wrap").on("change","#field-rfbwp_fb_page_type .mp-dropdown",function(){var t=e(this),a=t.parents("tr.page-set"),i=t.parents("tr.page-set").find("#field-rfbwp_page_html_second"),s=a.find("#rfbwp_fb_page_type").val();if(s=="Single Page"&&i.hasClass("active")){a.find("#field-rfbwp_fb_page_columns_sc a").trigger("click");a.find("#field-rfbwp_fb_page_columns_sc").removeClass("active")}else if(s=="Double Page"&&!i.hasClass("active")){a.find("#field-rfbwp_fb_page_columns_sc").addClass("active");a.find("#field-rfbwp_fb_page_columns_sc a").trigger("click")}});function d(t){var a=t.parents(".page-settings"),i=a.find("#rfbwp_fb_page_type").val(),s=t.parents("tr.page-set").find("#field-rfbwp_page_html_second");t.find(".html-editor").each(function(){var t=e(this),a=t.parents(".field").attr("id").replace("field-",""),i="rfbwp_html_"+Math.floor(Math.random()*1e4);if(tinymce.get(t.attr("id"))===null){t.attr("id",i);tinyMCE.init({mode:"exact",relative_urls:false,elements:i,skin:"mpc-flipbook",height:"240px",force_br_newlines:true,force_p_newlines:false,entity_encoding:"raw",verify_html:false,plugins:["autolink lists link image hr anchor","code media nonbreaking paste textcolor colorpicker textpattern"],image_advtab:true,menubar:false,toolbar1:"undo redo | styleselect | bold italic | forecolor backcolor | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link image media | code"});t.attr("data-editor",a)}});if(i=="Single Page"&&s.hasClass("active")){a.find("#field-rfbwp_fb_page_columns_sc a").trigger("click");a.find("#field-rfbwp_fb_page_columns_sc").removeClass("active")}else if(i=="Double Page"&&!s.hasClass("active")){a.find("#field-rfbwp_fb_page_columns_sc").addClass("active");a.find("#field-rfbwp_fb_page_columns_sc a").trigger("click")}}e(".wrap").on("mousedown","a.rfbwp-page-save",function(){var t=e(this),a=t.parents(".page-settings").find(".html-editor");a.each(function(){var t=e(this),a=tinyMCE.get(t.attr("id")).getContent().replace(/<p>&nbsp;<\/p>$/,"");tinyMCE.get(t.attr("id")).selection.select(tinyMCE.activeEditor.getBody(),true);tinyMCE.get(t.attr("id")).selection.collapse(false);t.val(a)})});function f(e){if(e.find("tr.display").length==0){var t=e.find("img.rfbwp-first-page").clone(true);e.find("img.rfbwp-first-page").remove();e.find("table.pages-table").after(t);e.find("img.rfbwp-first-page").css({display:"inline-block"})}}function c(e){e.find(".stacked-fields:not(:first-child):not(:last-child)").append('<div class="mpc-sortable-handle"><i class="fa fa-arrows-v"></i></div>');n(e);e.sortable({items:"> .stacked-fields:not(:first-child):not(:last-child)",placeholder:"stacked-fields ui-state-highlight",handle:".mpc-sortable-handle"});e.on("sortupdate",function(t,a){s(e)});e.find(".stacked-fields:not(:first-child):not(:last-child) .checkbox").on("change",function(){s(e)})}function g(t){t.find(".pages-table tbody").sortable({items:"> tr:not(.page-set)",placeholder:"page-set ui-state-highlight",handle:".mpc-sortable-handle"});t.find(".pages-table tbody").on("sortupdate",function(t,a){var i=e(this);r(i.parents(".pages-table"))})}function b(t){t.find(".field-select").each(function(){var t=e(this).find(".mp-dropdown");if(!t.data("select2"))t.select2({minimumResultsForSearch:10})})}function u(t){t.find(".field-color").each(function(){var t=e(this);if(!t.find("input").hasClass("wp-color-picker"))t.find("input").wpColorPicker()})}function v(t){var a=e("#mpc_icon_select_grid_modal");t.each(function(){var t=e(this);t.find(".mpc-icon-select").each(function(){var t=e(this),i=t.siblings(".mpc-icon-select-clear"),s=t.siblings(".mpc-icon-select-value"),n=t.children("i");t.on("click",function(e){if(a.length){a.dialog("option","target",t);a.dialog("open")}e.preventDefault()});t.on("mpc.update",function(e,a){s.val(a);n.attr("class",a);t.removeClass("mpc-icon-select-empty")});i.on("click",function(e){s.val("");n.attr("class","");t.addClass("mpc-icon-select-empty");e.preventDefault()})})})}function _(t){var a=e("#mpc_toc_generator_modal"),i=a.find("#toc_item_markup").clone().removeAttr("id"),s=a.find("#mpc_toc_items").html(""),n=t.parents("#field-rfbwp_pages").find("tr.page-set"),r=0;n.each(function(){var t=e(this),a=i.clone(),n=t.find("#rfbwp_fb_page_title").val(),p=t.find("#rfbwp_fb_page_index").val();r++;a.find(".page-checkbox").attr("name","page["+r+"]");a.find(".page-lp").html(r);a.find(".page-title").html(n);a.find(".page-number").html(p);s.append(a)})}function h(t){var a=e("#mpc_toc_generator_modal");t.each(function(){var t=e(this);t.find(".rfbwp-page-toc-popup").each(function(){var t=e(this);t.on("click",function(e){var i=t.parents(".field").next().find(".html-editor").attr("id");if(a.length){_(t);a.dialog("option","target",i);a.dialog("open")}e.preventDefault()})})})}O("books");e(".wrap").on("click","div.mp-toggle-header",function(t){t.preventDefault();var a=e(this),i=a.next("div.mp-toggle-content");if(a.hasClass("open"))a.removeClass("open");else a.addClass("open");u(i);v(i);ee(i);b(i);ie(i);te(i);L(i);var s=i.attr("data-toggle-section")=="field-rfbwp_fb_nav_menu_type";if(s)c(i);a.next("div.mp-toggle-content").slideToggle("slow")});var m=e("#rfbwp_flipbook_batch_ids"),w=e("#rfbwp_flipbook_batch_images_wrap"),k=e("#rfbwp_flipbook_batch_select"),x=e("#rfbwp_flipbook_batch_ids"),y=e("#rfbwp_flipbook_batch_images_wrap_large"),C=e("#rfbwp_flipbook_batch_select_large"),D=e("#rfbwp_flipbook_batch_import");var I=wp.media;I.view.Settings.Gallery=I.view.Settings.Gallery.extend({render:function(){return this}});e("#rfbwp_flipbook_batch_import").on("click",function(t){var a=e("#rfbwp_flipbook_batch_ids").val(),i=e("#rfbwp_flipbook_batch_ids_large").val(),s=(a.match(/,/g)||[]).length+1,n=(i.match(/,/g)||[]).length+1,r=false;if(a!=""&&i!=""){if(s!=n){V("red",mpcthLocalize.messages.dialogs.normalLarge,3e3)}else{r=true}}else if(a==""&&i!=""){r=true}else if(a!=""&&i==""){r=true}else{V("red",mpcthLocalize.messages.dialogs.noImages,3e3)}if(r){e.post(ajaxurl,{action:"batch_import",book_id:e("#rfbwp_tools").attr("data-book-id"),images_ids:e("#rfbwp_flipbook_batch_ids").val(),images_ids_large:e("#rfbwp_flipbook_batch_ids_large").val(),double_page:e("#rfbwp_flipbook_batch_double").is(":checked")},function(t){e("#rfbwp_flipbook_batch_ids").val("");e("#rfbwp_flipbook_batch_images_wrap").html("");e("#rfbwp_flipbook_batch_ids_large").val("");e("#rfbwp_flipbook_batch_images_wrap_large").html("");if(t=="error-book-id"){V("red","Wrong book ID.",3e3)}else if(t=="error-page-id"){V("red","Wrong page ID.",3e3)}V("green",mpcthLocalize.messages.dialogs.importFinished,3e3);e.post(ajaxurl,{action:"rfbwp_refresh_tabs_content"},function(t){K();e("form#options-form .group.settings, form#options-form .group.pages").remove();e("form#options-form div.group.books").after(t);e("form#options-form div.group").each(function(){var t=e(this);if(t.hasClass("settings")||t.hasClass("pages"))t.hide()});e("#mp-option-pages_"+e("#rfbwp_tools").attr("data-book-id")).find(".breadcrumbs .breadcrumb-2").trigger("click");$()})})}t.preventDefault()});e(".wrap").on("click",".upload_button",function(){if(s){s.open();return}var t=["image/jpeg","image/png","image/gif"],a=e(this).siblings(".upload"),i=e(this).siblings(".screenshot");var s=wp.media({title:mpcthLocalize.messages.dialogs.selectImage,button:{text:mpcthLocalize.messages.dialogs.insertImage},multiple:false});s.on("select",function(){var e=s.state().get("selection").first().toJSON();if(t.indexOf(e.mime)>=0){a.val(e.url);i.find("img:not(.default)").remove();i.prepend('<img src="'+e.url+'" alt="" />')}});s.open()});e(".wrap").on("click",".upload_file_button",function(){if(i){i.open();return}var t=e(this).siblings(".uploaded_file_name"),a=e(this).siblings(".upload");var i=wp.media({title:mpcthLocalize.messages.dialogs.selectImage,button:{text:mpcthLocalize.messages.dialogs.insertImage},multiple:false});i.on("select",function(){var e=i.state().get("selection").first().toJSON();a.val(e.id);t.html(e.filename)});i.open()});function S(e){if(e){var t=new wp.shortcode({tag:"gallery",attrs:{ids:e},type:"single"});var a=wp.media.gallery.attachments(t);var i=new wp.media.model.Selection(a.models,{props:a.props.toJSON(),multiple:true});i.gallery=a.gallery;i.more().done(function(){i.props.set({query:false});i.unmirror();i.props.unset("orderby")});return i}return false}e("#rfbwp_flipbook_batch_select, #rfbwp_flipbook_batch_select_large").on("click",function(t){var a="";if(e(this).is("#rfbwp_flipbook_batch_select_large"))a="_large";var i=e("#rfbwp_flipbook_batch_ids"+a).val(),s=i.length>0?S(i):false,n=wp.media({title:mpcthLocalize.messages.dialogs.selectImages,button:{text:mpcthLocalize.messages.dialogs.insertImages},frame:"post",state:"gallery-edit",multiple:true,selection:s});n.open();n.on("update",function(t){var i=t.models,s=[],n="";for(var r=0;r<i.length;r++){s[r]=i[r].id;n+='<img width="50px" height="50px" src="'+i[r].attributes.sizes.thumbnail.url+'" class="rfbwp-batch-image" alt="Batch image '+r+'">'}e("#rfbwp_flipbook_batch_ids"+a).val(s.join(","));e("#rfbwp_flipbook_batch_images_wrap"+a).html(n)});t.preventDefault()});e("#rfbwp_flipbook_batch_clear, #rfbwp_flipbook_batch_clear_large").on("click",function(t){var a="";if(e(this).is("#rfbwp_flipbook_batch_clear_large"))a="_large";e("#rfbwp_flipbook_batch_ids"+a).val("");e("#rfbwp_flipbook_batch_images_wrap"+a).fadeOut(function(){e("#rfbwp_flipbook_batch_images_wrap"+a).html("").show()});t.preventDefault()});e("#rfbwp_tools_toggle_title").on("click",function(t){var a=e(this),i=e("#rfbwp_tools_toggle_content");if(a.is(".option-open")){a.removeClass("option-open");i.slideUp()}else{a.addClass("option-open");i.slideDown()}t.preventDefault()});var z=e("#rfbwp_page_preview"),P=e("#rfbwp_page_preview_wrap");z.on("click",function(e){z.fadeOut(250,function(){P.find(".flipbook-container").removeClass("rfbwp-inited");P.html("");z.css("transform","")});z._active=undefined;e.preventDefault()});e(window).on("rfbwp-page-updated",function(){if(z._active!=undefined)z._active.trigger("click")});e("#options-form").on("click",".pages .breadcrumbs .breadcrumb:not(.selected)",function(){if(z._active!=undefined)z.trigger("click")});e("#options-form").on("click",".pages .thumb-preview .preview-page",function(t){var a=e(this),i=a.parents("div.pages").attr("id"),s=a.parents(".display").attr("id");z.fadeOut(250,function(){e.post(ajaxurl,{action:"preview_page",book_id:G(i),page_id:G(s)},function(t){if(t=="error-book-id"){V("red",mpcthLocalize.messages.dialogs.bookID,3e3)}else if(t=="error-page-id"){V("red",mpcthLocalize.messages.dialogs.bookID,3e3)}else{P.html(t);z.fadeIn(250);P.find(".flipbook-container").addClass("rfbwp-inited");P.find("img.lazy-load").each(function(){var t=e(this);t.attr("src",t.attr("data-src"))});if(z.width()>800)z.css("transform","scale("+(800/z.width()).toFixed(2)+")");else if(z.height()>e(window).height()-100){z.css("transform","scale("+((e(window).height()-100)/z.height()).toFixed(2)+")")}}})});z._active=a;t.preventDefault()});e("#rfbwp_import_back_url").val(location.href);e("#rfbwp_flipbook_import").on("click",function(t){e("#rfbwp_import").click();t.preventDefault()});e("#rfbwp_flipbook_export").on("click",function(t){var a=ajaxurl+"?action=export_flipbooks&book_id="+e("#rfbwp_tools").attr("data-book-id");location.href=a;t.preventDefault()});function L(t){t.find(".fb-dyn-images").each(function(){var t=e(this);t.attr("src",t.attr("data-src"))})}function j(){var t=e("#mp-option-books .books td");t.each(function(t,a){var i=mpcthLocalize.messages.errors.error;var s=false;var n=0;var r=e("#mp-option-pages_"+t+" .pages-table tr:not(.page-set)");r.each(function(t,a){if(e(a).find(".page-type").html()=="Single Page")n++;else n+=2});if(r.first().find(".page-type").html()!="Single Page"){i+=mpcthLocalize.messages.errors.firstPage;s=true}if(r.last().find(".page-type").html()!="Single Page"){if(s){i+=", ";s=false}i+=mpcthLocalize.messages.errors.lastPage;s=true}if(n<4){if(s){i+=", ";s=false}i+=mpcthLocalize.messages.errors.minPages;s=true}if(n%2!=0){if(s){i+=", ";s=false}i+=mpcthLocalize.messages.errors.evenPages}if(i!=mpcthLocalize.messages.errors.error)e(a).find(".book-error .distinction").html(i+".")})}function O(t,a){Q();e("div.bottom-nav").hide();e("#rfbwp_tools").hide();if(t=="book-settings"){e("div.bottom-nav").find("a.edit-button").attr("value","Edit Settings").attr("href","#"+a);e("div.group.settings").find("div.mp-toggle-content:first").css("display","block");
e("div.group.settings").find("div.mp-toggle-header:first").addClass("open");e("div.breadcrumbs").fadeIn();e("div.breadcrumbs span.breadcrumb-1").addClass("selected");e("div.breadcrumbs .edit-button-alt").css("display","block");e("div.bottom-nav").fadeIn()}else if(t=="books"||t=="help"){j();e("div.breadcrumbs").hide();e("div.breadcrumbs .edit-button-alt").hide()}else if(t=="add"){e("div.breadcrumbs").fadeIn();e("div.bottom-nav").fadeIn();e("div.breadcrumbs .edit-button-alt").hide()}else if(t=="view-pages"){e("div.breadcrumbs").fadeIn();e("div.breadcrumbs span.breadcrumb-2").addClass("selected");e("div.breadcrumbs .edit-button-alt").hide();e("#rfbwp_tools").fadeIn()}else{U()}}function U(){K();e.post(ajaxurl,{action:"rfbwp_refresh_books"},function(t){e("div.field-books div.controls").children().remove();e("div.field-books div.controls").append(t);j();$()})}function N(t){var a=G(t);a=a-1;e("table.page-table tr#pset_"+a).after(e("table.page-table tr#"+t))}function E(t){var a=-1;var i=-1;t.find("tr.page-set").each(function(){var t=e(this),s;a++;i++;if(G(t.attr("id"))!=a.toString()){t.attr("id","pset_"+a.toString())}if(t.prev().hasClass("display")&&G(t.prev().attr("id"))!=a.toString()){t.prev().attr("id","page-display_"+a.toString())}if(t.find("div.page-settings").attr("id")!=undefined&&G(t.find("div.page-settings").attr("id"))!=a.toString()){t.find("div.page-settings").attr("id","ps_"+a.toString())}t.find("div.controls").children().each(function(){var t=e(this),i;if(t.attr("name")!=undefined&&t.attr("name")!=""){i=t.attr("name");i=i.split("[pages]");if(t.hasClass("html-editor")&&t.attr("data-editor"))i=i[0]+"[pages]["+a+"]["+t.data("editor")+"]";else i=i[0]+"[pages]["+a+"]["+t.attr("id")+"]";t.attr("name",i)}});t.find("input#rfbwp_fb_page_index").attr("value",i);if(t.find("div#field-rfbwp_fb_page_type select").val()=="Double Page")i++})}var M=e("div.mpc-logo").css("background-image");var T=e.browser;if(T.mozilla||T.msie)M=M.split('url("');else M=M.split("url(");M=M[1];M=M.split("massive-panel");M=M[0]+"massive-panel/";function R(t){t.find("tr.page-set").each(function(){var t=e(this),a=t.find("select.rfbwp-page-type option:selected").text(),i=t.find("input#rfbwp_fb_page_index").attr("value"),s=t.find("input#rfbwp_fb_page_bg_image").attr("value");if(a==undefined||i==undefined)return;if(t.prev().hasClass("display")){t.prev().find("span.page-type").text(a);if(a=="Single Page")t.prev().find("span.page-index").text(i);else t.prev().find("span.page-index").html(i+" - "+(parseInt(i)+1));if(s!="")t.prev().find("td.thumb-preview img").attr("src",s);else t.prev().find("td.thumb-preview img").attr("src",M+"images/default-thumb.png")}else{var n=G(t.parents("div.pages").attr("id"));var r="";r+='<tr id="page-display_'+t.parent().find("tr.display").length+'" class="display"><td class="thumb-preview">';if(s!="")r+='<img src="'+s+'" alt=""/>';else r+='<div class="no-cover"></div>';r+='<span class="page-type">'+a+"</span>";r+='<div class="mpc-buttons-wrap page-options">';r+='<a class="add-page mpc-button"><i class="dashicons dashicons-plus"></i> <span class="tooltip">'+mpcthLocalize.addNewPage+"</span></a>";r+='<a class="edit-page mpc-button" href="#'+n+'"><i class="dashicons dashicons-edit"></i> <span class="tooltip">'+mpcthLocalize.editPage+"</span></a>";r+='<a class="preview-page mpc-button" href="#'+n+'"><i class="dashicons dashicons-visibility"></i> <span class="tooltip">'+mpcthLocalize.previewPage+"</span></a>";r+='<a class="delete-page mpc-button" href="#'+n+'"><i class="dashicons dashicons-trash"></i> <span class="tooltip">'+mpcthLocalize.deletePage+"</span></a>";r+='</div></td><td class="navigation">';r+='<a class="up-page mpc-button"><i class="dashicons dashicons-arrow-up-alt2"></i></a>';r+='<input type="checkbox" class="page-checkbox"/>';r+='<span class="desc">page</span>';if(a!="Double Page")r+='<span class="page-index"><span class="index">'+i+"</span></span>";else r+='<span class="page-index"><span class="index">'+i+" - "+(parseInt(i)+1)+"</span></span>";r+='<a class="down-page mpc-button"><i class="dashicons dashicons-arrow-down-alt2"></i></a>';r+='</td><td class="mpc-sortable-handle"><i class="fa fa-arrows-v"></i></td></tr>';t.before(r);t.prev().css({display:"none"});t.prev().slideDown()}})}function A(t,a){t=G(t);var i=e("table.pages-table tr#pset_"+t).prev().find("#rfbwp_fb_page_index").attr("value"),s=e("table.pages-table tr#pset_"+t).prev().find("select.rfbwp-page-type option:selected").attr("value"),n=s=="Double Page"?parseInt(i)+2:parseInt(i)+1;a=G(a);var r=0;e("table.pages-table tr#pset_"+t).find(".field").each(function(){r++;var i=e(this);if(i.find("input").attr("name")!=undefined&&i.find("input").attr("name")!="")i.find("input").attr("value","");if(i.attr("id")=="field-rfbwp_fb_page_index")i.find("#rfbwp_fb_page_index").attr("value",n);if(i.attr("id")=="field-rfbwp_fb_page_type"){var s='<select class="mp-dropdown rfbwp-page-type" name="rfbwp_options[books]['+a+"][pages]["+t+'][rfbwp_fb_page_type]" id="rfbwp_fb_page_type" title=""><option value="Single Page">Single Page</option><option selected="" value="Double Page">Double Page</option></select>';i.find(".mp-dropdown").remove();i.find(".controls").prepend(s);b(i.parents("tr#pset_"+t))}if(i.attr("id")=="field-rfbwp_fb_page_bg_image"||i.attr("id")=="field-rfbwp_fb_page_bg_image_zoom"){i.find("img:not(.default)").remove();i.find("img").show()}if(i.attr("id")=="field-rfbwp_page_html"||i.attr("id")=="field-rfbwp_page_html_second"){var p=i.find(".html-editor");i.find(".mce-tinymce").remove();p.val("").show();p.attr("id","rfbwp_page_html");d(i);h(i.prev())}if(i.attr("id")=="field-rfbwp_page_css"){if(i.find(".rfbwp_page_css_handler").length>0){i.find(".rfbwp_page_css_handler").attr("id","delete_css_editor");var o=ace.edit("delete_css_editor");o.destroy();o.container.remove()}i.find("#rfbwp_page_css").val("");l(i.find("#rfbwp_page_css"))}})}function J(t){t.find("tr.display").each(function(){var t=e(this),a=0,i,s=t.next();a=parseInt(s.find("input#rfbwp_fb_page_index").attr("value"));if(s.hasClass("page-set")){a=parseInt(s.find("input#rfbwp_fb_page_index").attr("value"));i=F(a,t);if(i!=undefined){i.next().after(t);if(s.hasClass("page-set"))t.after(s)}}E(t.parents("table.pages-table"))})}function F(t,a){var i;if(t==""||isNaN(t))t=0;e("table.pages-table tr.display").each(function(){var s=e(this),n=s.next();if(t>parseInt(n.find("input#rfbwp_fb_page_index").attr("value"))){i=s}if(t==n.find("input#rfbwp_fb_page_index").attr("value")&&s.attr("id")!=a.attr("id")){if(n.find("select.rfbwp-page-type option:selected").attr("value")=="Single Page")t++;else if(n.find("select.rfbwp-page-type option:selected").attr("value")==="Double Page")t+=2;a.next().find("input#rfbwp_fb_page_index").attr("value",t);i=s}});return i}function V(t,a,i){var s=e("div#bg-content"),n=e("#wpcontent").offset().left+20+215,r=e(window).height(),p=e("#bg-content").height(),o;s.append('<span class="rfbwp-alert '+t+'">'+a+"</span>");e("span.rfbwp-alert").css("display","none");if(p<=r)e("span.rfbwp-alert").addClass("not-fixed");else e("span.rfbwp-alert").removeClass("not-fixed").css({left:n});e("span.rfbwp-alert").css("display","block").animate({opacity:1},300);o=setInterval(function(){e("span.rfbwp-alert").animate({opacity:0},300,function(){e("span.rfbwp-alert").css("display","none").remove();clearInterval(o)})},i)}function B(t,a,i){var s=e("div#bg-content"),n;s.append('<span class="rfbwp-alert '+t+'">'+a+"</span>");e("span.rfbwp-alert").hide();e("span.rfbwp-alert").css({top:e(this).scrollTop()+10});e("span.rfbwp-alert").fadeIn("slow");n=setInterval(function(){e("span.rfbwp-alert").fadeOut("slow",function(){e(this).remove();clearInterval(n)})},i)}function q(){var e=window.location.href.slice(window.location.href.indexOf("#")+1).split("&");return e}function G(e){if(e!==""){e=e.toString();e=e.split("_");e=e[1]}return e}function Q(){e("span.breadcrumb").removeClass("selected")}var W=e("#curtain");function K(){var t=e("#wpcontent").offset().left+20+405,a=e(window).height(),i=e("#bg-content").height();if(i<=a)W.find(".fb-spinner").addClass("not-fixed");else W.find(".fb-spinner").removeClass("not-fixed").css({left:t});W.css({display:"block"});W.css("visibility","visible");W.stop(true).animate({opacity:1},300)}function $(){W.stop(true).animate({opacity:0},300,function(){W.css("visibility","hidden");W.css("display","none")})}e(".wrap").slideDown(500);var H="",X=[];if(mpcthLocalize.googleFonts==false){e.getJSON("https://www.googleapis.com/webfonts/v1/webfonts?callback=?&key="+mpcthLocalize.googleAPIKey,function(t){if(t.error!=undefined){e("#mpcth_menu_font").after('<div class="mpcth-of-error">'+mpcthLocalize.googleAPIErrorMsg+"</div>")}else{var a={items:[]};for(var i=0;i<t.items.length;i++){a.items[i]={};a.items[i].family=t.items[i].family;a.items[i].variants=t.items[i].variants}jQuery.ajax({type:"POST",url:ajaxurl,action:"mpcth_cache_google_webfonts",google_webfonts:JSON.stringify(a),dataType:"json"});Y(t)}})}else{Y(JSON.parse(mpcthLocalize.googleFonts))}function Y(e){if(e.items!=undefined){var t=e.items.length;X=e.items;H="";for(var a=0;a<t;a++){var i=X[a].family;H+='<option class="mpcth-option-google" data-index="'+a+'" value="'+i+'">'+i+"</option>"}}}function Z(e){var t=e.data.el;t.siblings(".font-handler").val(t.val())}function ee(t){t.each(function(){var t=e(this);t.find(".rfbwp-of-input-font").each(function(){var t=e(this);if(!t.data("select2"))t.append(H).select2().select2("val",t.siblings(".font-handler").val()).on("change",{el:t},Z)})})}function te(t){t.find("#rfbwp_fb_hc_fco, #rfbwp_fb_hc_fci, #rfbwp_fb_hc_bco, #rfbwp_fb_hc_bci").each(function(){var t=e(this);t[0].name=t[0].name.replace("[pages][-1]","")})}function ae(e){var t=e.parents('.stacked-fields:not([data-section-id="field-rfbwp_fb_nav_menu_type"])');if("field-"+e.attr("id")==t.data("section-id")){if(e.is(":checked")){t.find(".field:not(#"+t.data("section-id")+")").css("display","inline-block");t.find(".field:not(#"+t.data("section-id")+")").animate({opacity:1},300)}else{t.find(".field:not(#"+t.data("section-id")+")").animate({opacity:0},300,function(){t.find(".field:not(#"+t.data("section-id")+")").css("display","none")})}}}function ie(t){t.find(".stacked-fields .checkbox").each(function(){var t=e(this);ae(t)})}e(".wrap").on("change",".stacked-fields .checkbox",function(){var t=e(this);ae(t)});e(".wrap").on("change","#rfbwp_fb_pre_style",function(){var t=e(this),a=t.parents(".group.settings"),i=t.val();if(i!==""&&i!==null)se(a,i)});e(".wrap").on("click","#rfbwp_fb_down_preset",function(t){var a=e(this),i=a.parents(".group.settings");ne(i);t.preventDefault()});function se(t,a){var i;K();e.getJSON(mpcthLocalize.presetsURL+a+".json",function(e){e=e.preset;for(i=0;i<e.length-1;i++){re(t.find("#"+e[i].field_id),e[i].value,e[i].type)}V("green",mpcthLocalize.messages.dialogs.presetLoaded,1500);$()})}function ne(t){var a,i,s,n={preset:[]};t.find(".field").each(function(){var t=e(this);if(t.hasClass("field-checkbox")){i=t.find('input[type="checkbox"]').prop("checked");a=t.find('input[type="checkbox"]').attr("id");s="checkbox"}else if(t.hasClass("field-select")){i=t.find("select").val();a=t.find("select").attr("id");s="select"}else if(t.hasClass("field-font_select")){i=t.find("input.font-handler").val();a=t.find("select").attr("id");s="font-select"}else if(t.hasClass("field-text-small")){i=t.find("input").val();a=t.find("input").attr("id");s="text"}else if(t.hasClass("field-color")){i=t.find("input").val();a=t.find("input").attr("id");s="color"}else if(t.hasClass("field-icon")){i=t.find("input.mpc-icon-select-value").val();a=t.attr("id");s="icon"}n.preset.push({field_id:a,value:i,type:s})});n=JSON.stringify(n)}function re(e,t,a){if(t==undefined)return;if(a=="text"){e.val(t)}else if(a=="color"){e.val(t).trigger("change")}else if(a=="select"){e.val(t).trigger("change")}else if(a=="checkbox"){e.prop("checked",t)}else if(a=="icon"){e.find("input").val(t);e.find(".mpc-icon-select i").attr("class",t);if(t!="")e.find(".mpc-icon-select").removeClass("mpc-icon-select-empty")}else if(a=="font-select"){e.siblings("input").val(t).trigger("change")}}})})();